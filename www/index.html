<!DOCTYPE html>
<html lang="en">
<head>  
      <title>OpenEth</title>
		<base href="/">
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">    
      <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet" type="text/css">
      <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet" type="text/css">
      <link href="openeth.css" rel="stylesheet">
</head>
<body>
	<nav class="navbar navbar-default navbar-fixed-top">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>    
              </button>
              <a class="navbar-brand" href="index.html"><img src="images/brand_logo.png" class="hidden-xs" alt="openeth"></a>
            </div>
            <div class="collapse navbar-collapse" id="myNavbar">
              <ul class="nav navbar-nav">
                <li><a href="index.html">home</a></li>
                <li><a href="index.html">play</a></li>
                <li><a href="blog.html">blog</a></li>
                <li><a href="about.html">about</a></li>
                <li><a href="contact.html">contact</a></li>
				<li><a class="button" id="register" onclick="register()">Join OpenEth</a></li>
                <li><a id="button_login" onclick="login()" href="#">log in</a></li>
                <li><a id="button_logout" class="hidden" onclick="logout()" href="#">log out</a></li>
              </ul>
            </div>
          </div>
			<div id="throbber_login" class="hidden"><span class="spinner"></span></div>
	</nav>
		<div id="head_dilemma" class="hidden">
			<p class="one-column" data-content="name"></p>
			<p><button class="button edit" onclick="edit_current_dilemma()">Edit</button></p>
		</div>
		<div id="head_case" class="hidden">
			<p class="one-column" data-content="name"></p>
			<p><button class="button edit" onclick="edit_current_case()">Edit</button></p>
		</div>
		<div id="head_edit_case" class="hidden">
			<p class="one-column">Edit case</p>
			<p>
				<button id="case_save" class="button save" onclick="store_case()">
					<span>Save</span>
				</button>
			</p>
			<p>
				<button id="case_delete" class="button delete" onclick="delete_case()">
					<span>Delete</span>
				</button>
			</p>
		</div>
	</div>

<main id="start" class="hidden">
	<div class="container">
		<div class="row">
        	<div class="col-lg-12">
            	<h3 class="page-header">Choose your challenge*</h3>
            </div>
        </div>
        <div class="container">
        	<div class="row contentdiv">
            	<div class="col-md-6 col-sm-6 col-xs-12">
                	<h2 class="main-h2">Level 1: Fast<br><small>OPEN ACCESS</small></h2>
                    <img src="images/fast.jpg" class="img-position"/>
                    <p class="main-p">Have fun answering questions, use your intuition, race with time, leave 
                       your footprint on understanding ethical decisions.
                    </p>
                    <button type="button" class="main-button"><a href="#">PLAY</a></button>
               </div>
               <div class="col-md-6 col-sm-6 col-xs-12">
                    <h2 class="main-h2">Level 2: Slow<br>
                        <small>NOT TOO SEVERE RESTRICTIONS ADDED</small>
                    </h2>
                    <img src="images/slow.jpg" class="img-position"/>
                    <p class="main-p">Explore the intricate wolrd of ethics, share your doubts, discuss with
                        others, build useful ethics systems.
                    </p>
                    <button type="button" class="main-button"><a href="#">PLAY</a></button>
                </div>
            </div>
        </div>  
     	<div class="row">
        	<div class="col-lg-12">
                 <h3 class="page-content">*Why challenges?</h3>
                 <p class="quote"><i>Whatever Daniel K. quote there is to pick</i></p>
                 <p class="author">-Whatever Author, Title, year</p>
                 <h6 class="text-field">Maybe some text overhere. If yes, please be short.</h6>
                 <h6 class="text-field">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras dapibus vulputate diam eu pretium. 
                	Mauris elit orci, ultricies id fermentum vel, porta et eros. Vestibulum
            	</h6>
        	</div>
    	</div>
	</div>
	<div class="container">
    	<div class="row">
        	<div class="col-lg-12 headerdiv">
            	<h3 class="dilemma-header">Dilemmas*</h3>
              	<p class="dialog">Play with ethics exploring and adding dilemmas.<br>
                Help to list and specify more and less preferable ethical scenarios.
                </p>
            </div>
        </div>
		<div class="container">
        	<div class="row resize-row">
            	<div class="col-sm-3">
                	<a href="#" class="dilemma-link add dilemma" id="add_dilemma" onclick="go_to('/dilemmas/new?edit')">+ ADD DILEMMA</a>
                </div>
                <div class="col-sm-offset-4 col-sm-5">    
                	<div class="input-group stylish-input-group">
                    	<span class="input-group-addon">
                        	<button type="submit">
                            	<span class="glyphicon glyphicon-search"></span>
                            </button>  
                        </span>
                        <input type="search" class="form-control"  placeholder="Search" >
                    </div>
               </div>
            </div>
       	</div>
		<div class="container">
			<template data-array="dilemmas">
				<div class="col-md-4 col-sm-6 col-xs-12 dilemma-content" onclick="open_dilemma(this)">
					<input type="hidden" data-value="id">
					<input type="hidden" data-value="author">
                	<h2 class="main-h2" data-content="name"></h2>
                    <img src="images/vehicles.jpg" class="img-position"/>
                    <p class="dilemma-text" data-content="description"></p>
                    <button type="button" class="main-button" onclick="edit_dilemma(event, this)">
						<input type="hidden" data-value="id">
						PLAY
					</button>
					<!--<template data-array="features">
						<li data-content=""></li>
					</template>-->
					<!--<span data-content="num_cases"></span>-->
				</div>
			</template>
	</div>
</main>

<main id="dilemma" class="hidden">
	<input type="hidden" data-value="id">
	<input type="hidden" data-value="author">

	<div class="container">
    	<div class="row list-header-margin">
        	<div class="col-lg-offset-1 col-lg-2 col-md-2 col-sm-offset-1 col-sm-1 col-xs-2 list-margin">    
            	<a href="/" class="icon">
					<img src="images/arrow.jpg">
                	<span class="hidden-sm hidden-xs list-font">List of Dilemma</span>
				</a>
            </div>
            <div class="col-lg-9 col-md-9 col-sm-10 col-xs-8">
            	<img src="images/vehicles.jpg" class="resize-img hidden-xs"/>    
                <p class="title-margin" data-content="name"></p>
                <small>Added by Remco Bloemen</small>    
            </div>  
		</div>
       	<div class="row text-bar">
        	<div class="col-lg-offset-3 col-lg-9 col-md-offset-3 col-md-9 col-sm-12 col-xs-12">
            	<ul class="li-position">
                	<li class="li-style"><a href="#dilemmadesc" data-toggle="tab" class="li-link">DILEMMA DESCRIPTION</a></li>
                    <li class="li-style"><a href="#dilemmacases" data-toggle="tab" class="li-link">CASES</a></li>
                    <li class="li-style"><a href="#dilemmadiscussion" data-toggle="tab" class="li-link">DISCUSSION</a></li>
                </ul>
			</div>
       	</div>
		<div class="tab-content clearfix">
			<div class="tab-pane active" id="dilemmadesc">
				<div class="col-lg-offset-1 col-lg-2 col-sm-12 col-xs-12">    
        			<p class="reposition-desc-text">Description</p>
        		</div>
        		<div class="col-lg-7 col-sm-12 col-xs-12 dilemma-desc">
					<p data-content="description"></p>
				</div>
				<div class="row">
        			<div class="col-lg-offset-1 col-lg-2 col-sm-12 col-xs-12 list-margin">    
            			<p>Correct actions</p>
           			</div>
            		<div class="col-lg-7 col-sm-12 col-xs-12 list-content-margin">
						<template data-array="actions">
							<li class="dilemma-list dilemma-position" data-content=""></li>
						</template>
            		</div>
       			</div>
       			<div class="row">
           			<div class="col-lg-offset-1 col-lg-2 col-sm-12 col-xs-12 list-margin">
            		   <p>Features</p>
           			</div>
           			<div class="col-lg-7 col-sm-12 col-xs-12 list-content-margin">
						<template data-array="features">
						<li class="dilemma-list dilemma-position" data-content=""></li>
						</template>
           			</div>
       			</div>
       			<div class="row">
           			<div class="col-lg-offset-1 col-lg-2 col-sm-12 col-xs-12 list-margin">
            	   		<p>Key takeaway/Duties</p>
           			</div>
           			<div class="col-lg-7 col-sm-12 col-xs-12 list-content-margin">
            			<p>It can be inferred that there are (prima facie) duties to:</p>
						<template data-array="duties">
							<li class="dilemma-list dilemma-position" data-content=""></li>
						</template>
           			</div>
       			</div>
				<div class="row">
        			<div class="col-lg-offset-1 col-lg-2 col-sm-12 col-xs-12 list-margin">
            			<p>Rules</p>
            		</div>
            		<div class="col-lg-7 col-sm-12 col-xs-12 rule-dilemma">
						<ul class="principles">
							<template data-array="principles">
								<li class="principle dilemma-list">
									<p>An action is ethically preferable to another if it</p>
									<ul class="clauses">
										<template data-array="clauses">
											<li class="clause dilemma-list" data-content=""></li>
										</template>
									</ul>
								</li>
							</template>
						</ul>
            		</div>
        		</div>
			</div>
			<div class="tab-pane" id="dilemmacases">
				<div class="row">
        			<div class="col-lg-offset-1 col-lg-2 col-md-12 col-sm-12 col-xs-12 list-margin">
            			<p>Cases</p>
            		</div>
            		<div class="col-lg-7 col-md-12 col-sm-12 col-xs-12 case-content">
            		  	 <div class="row">
							<template data-array="cases">
								<div class="col-lg-6 col-md-12 col-sm-12 col-xs-12 " onclick="open_case(this)">
									<input type="hidden" data-value="id">
            		            	<p class="case-margin" data-content="name"></p> <a href="#" onclick="open_case(this)" class="case-link">READ MORE</a>
            		                <br>
									<p class="cursor" data-content="description"></p>
            		                <p class="case-position">Correct action: &nbsp;</p>
									<p class="case-position" data-content="action"></p>
            		            </div>
							</template>
						</div>
					</div>
				</div>
			</div>
			<div class="tab-pane" id="dilemmadiscussion">
				<div class="row">
                	<div class="col-lg-offset-3 col-lg-9 col-md-offset-3 col-md-9 col-sm-12 col-xs-12 list-margin">
                	    <a href="#" class="li-content-link">+ADD COMMENT</a>&nbsp; &nbsp; &nbsp;<a href="#" class="li-content-link">+ADD FILTERS</a>&nbsp;<span>(no filters)</span>
                	</div>    
            	</div>
            	<div class="row">
                	<div class="col-lg-offset-2 col-lg-1 col-md-offset-2 col-md-1 col-sm-2 col-xs-2 list-margin">    
                	    <img src="images/star.jpg"/>
                	</div>
                	<div class="col-lg-8 col-md-8 col-sm-10 col-xs-10 comment-margin">
                	        <p><b>Remco Bloemen</b> added case: <b>Name 1</b>
                	        </p>
                	        <span><a href="#" class="tab">Reply</a>&nbsp; &nbsp; <a href="#" class="tab">Comment</a>&nbsp; &nbsp;<img src="images/heart.jpg"/>
                	        </span>
                	</div>  
            	</div>
            	<div class="row">
                	<div class="col-lg-offset-2 col-lg-1 col-md-offset-2 col-md-1 col-sm-2 col-xs-2 list-margin">    
                    	<img src="images/yellowstar.jpg"/>
                	</div>
                	<div class="col-lg-8 col-md-8 col-sm-10 col-xs-10 comment-margin">
                        <p><b>Remco Bloemen</b> added dillema : <b>Autonomous car</b>
                        </p>
                        <span><a href="#" class="tab">Reply</a>&nbsp; &nbsp; <a href="#" class="tab">Comment</a>&nbsp; &nbsp;<img src="images/heart.jpg"/>
                        </span>
                	</div>  
            	</div>
            	<div class="row">
                	<div class="col-lg-offset-2 col-lg-1 col-md-offset-2 col-md-1 col-sm-2 col-xs-2 list-margin">    
                	    <img src="images/lightmessage.jpg"/>
                	</div>
                	<div class="col-lg-8 col-md-8 col-sm-10 col-xs-10 comment-margin">
                        <p><b>Remco Bloemen</b> added on case <b>Name 1</b> :Somehow comments at least two levels facebook like comment.
                        <br>Mentions @Nell Watson (one more color needed)
                        </p>
                        <span><a href="#" class="tab">Reply</a>&nbsp; &nbsp; &nbsp; &nbsp;<img src="images/heart.jpg"/>
                        </span>
                        <div class="div-margin">
                            <p><b>Nell Watson</b>Writes something</p>
                            <span><a href="#" class="tab">Reply</a>&nbsp; &nbsp; &nbsp; &nbsp;<img src="images/heart.jpg"/>
                            </span>
                        </div>
                	</div>  
            	</div>
				<div class="row">
                	<div class="col-lg-offset-2 col-lg-1  col-md-offset-2 col-md-1 col-sm-2 col-xs-2 list-margin">    
                	    <img src="images/yellowmessage.jpg"/>
                	</div>
                	<div class="col-lg-8 col-md-8 col-sm-10 col-xs-10 comment-margin">
                        <p><b>Remco Bloemen</b> on dillema <b>Autonomous Vehicles</b> :Somehow comments at least two levels facebook
                            like comment. Mentions @Nell Watson (one more color needed)
                        </p>
                        <span><a href="#" class="tab">Reply</a>&nbsp; &nbsp; &nbsp; &nbsp;<img src="images/heart.jpg"/>
                        </span>
                	</div>
            	</div>
            	<div class="row">
                	<div class="col-lg-offset-2 col-lg-1 col-md-offset-2 col-md-1 col-sm-2 col-xs-2 list-margin">
                	    <img src="images/message.jpg"/>
                	</div>
                	<div class="col-lg-8 col-md-8 col-sm-10 col-xs-10 comment-margin">
                        <p><b>Ola</b> on feature <b>Harm</b> :Lorem ipsum dolores etc.
                        </p>
                        <span><a href="#" class="tab">Reply</a>&nbsp; &nbsp; &nbsp; &nbsp;<img src="images/heart.jpg"/>
                        </span>
                	</div>
            	</div>
            	<div class="row">
                	<div class="col-lg-offset-2 col-lg-1  col-md-offset-2 col-md-1 col-sm-2 col-xs-2 list-margin">
                    	<img src="images/yellowmessage.jpg"/>
                	</div>
                	<div class="col-lg-8 col-md-8 col-sm-10 col-xs-10 comment-margin">
                        <p><b>Remco Bloemen</b> on dillema <b>Autonomous Vehicles</b> :
                        </p>
                        <div class="">
                            <p><i>Part of the dilemma, lorem ipsum</i></p>
                        </div>
                        <p>Somehow comments at least two levels facebook like comment. Mentions
                            @Nell Watson (one more color needed)
                        </p>
                        <span><a href="#" class="tab">Reply</a>&nbsp; &nbsp; &nbsp; &nbsp;<img src="images/blackheart.jpg"/>
                        </span>
                	</div>
            	</div>
            	<div class="row">
                	<div class="col-lg-offset-2 col-lg-1  col-md-offset-2 col-md-1 col-sm-2 col-xs-2 list-margin">
                	    <img src="images/yellowmessage.jpg"/>
                	</div>
                	<div class="col-lg-8 col-md-8 col-sm-10 col-xs-10 comment-margin">
                	        <p><b>Remco Bloemen</b> on dillema <b>Autonomous Vehicles</b> :
                	        </p>
                	        <p>The driver of the car is either speeding, comment comment comment comment commet certain
                	            circumstances, normal rules of the road can be fairly circumvented. Comment comment comment
                	            Alternative version of a comment with a quote.
                	        </p>
                	        <span><a href="#" class="tab">Reply</a>&nbsp; &nbsp; &nbsp; &nbsp;<img src="images/blackheart.jpg"/>
                	        </span>
                	</div>
				</div>
			</div>
		</div>
	</div>
</main>

<main id="case" class="hidden">
	<input type="hidden" data-value="id">
	<input type="hidden" data-value="dilemma_id">
	<input type="hidden" data-value="author">

	<div class="container">
    	<div class="row list-header-margin">
        	<div class="col-lg-offset-1 col-lg-2 col-md-2 col-sm-offset-1 col-sm-1 col-xs-2 list-margin">    
            	<a href="#" class="icon"><img src="images/arrow.jpg">
                	<span class="hidden-sm hidden-xs list-font">List of Dilemma</span>
                </a>
           </div>
           <div class="col-lg-9 col-md-9 col-sm-10 col-xs-8">
                <img src="images/vehicles.jpg" class="resize-img hidden-xs"/>    
                <p class="title-margin">Autonomous Vehicles</p>
                <small>Added by Remco Bloemen</small>    
            </div>  
       </div>    
       <div class="row text-bar">
       		<div class="col-lg-offset-3 col-lg-9 col-md-offset-3 col-md-9 col-sm-12 col-xs-12">
        		<ul class="li-position">
            		<li class="addcase-style"><a href="#" onclick="add_case(this)">+ADD CASE</a></li>
                	<li class="addcase-style"><a href="#">EDIT</a></li>
            	</ul>
       		</div>
   		</div>    
		<div class="row">    
    		<div class="col-lg-offset-3 col-lg-6 col-md-offset-3 col-md-6 col-sm-12 col-xs-12 viewcase-reposition">
        		<p class="addcase-margin">Asimov Classics</p>
                <small>Added by Remco Bloemen</small><br><br>   
                <p data-content="description"></p> 
                <p>Correct action:</p>             
				<p data-content="action_label"></p>
            </div>
        </div>
       	<div class="row">
        	<div class="col-lg-offset-1 col-lg-2 col-sm-12 col-xs-12 list-margin">
           	   <p>Features</p>
           	</div>
           	<div class="col-lg-7 col-sm-12 col-xs-12 list-content-margin">
				<table>
				<thead>
					<tr>
						<th>Feature</th>
						<template data-array="actions">
							<th class="table-margin" data-content=""></th>
						</template>
					</tr>
				</thead>
				<tbody>
					<template data-array="features">
						<tr>
							<td data-content="feature"></td>
							<template data-array="values">
								<td class="table-margin" data-content=""></td>
							</template>
						</tr>
					</template>
				</tbody>
				</table>
           	</div>
       	</div>
    </div>          
</main>

<main id="edit_dilemma" class="hidden">
	<input type="hidden" data-value="id">
	<input type="hidden" data-value="dilemma_id">
	<input type="hidden" data-value="author">

	<div class="container">
    	<div class="row list-header-margin">
        	<div class="col-lg-offset-1 col-lg-2 col-md-2 col-sm-offset-1 col-sm-1 col-xs-2 list-margin">    
            	<a href="/" class="icon">
					<img src="images/arrow.jpg">
                	<span class="hidden-sm hidden-xs list-font">List of Dilemma</span>
				</a>
            </div>
            <div class="col-lg-9 col-md-9 col-sm-10 col-xs-8">
            	<img src="images/vehicles.jpg" class="resize-img hidden-xs"/>    
                <p class="title-margin" data-content="name"></p>
                <small>Added by Remco Bloemen</small>    
            </div>  
		</div>
       	<div class="row text-bar">
        	<div class="col-lg-offset-3 col-lg-9 col-md-offset-3 col-md-9 col-sm-12 col-xs-12">
            	<ul class="li-position">
                	<li class="li-style"><a href="#editdilemmadesc" data-toggle="tab" class="li-link">DILEMMA DESCRIPTION</a></li>
                    <li class="li-style"><a href="#editdilemmacases" data-toggle="tab" class="li-link">CASES</a></li>
                    <li class="li-style"><a href="#editdilemmadiscussion" data-toggle="tab" class="li-link">DISCUSSION</a></li>
                </ul>
            </div>
       	</div>
		<div class="tab-content clearfix">
			<div class="tab-pane active" id="editdilemmadesc">
				<div class="col-lg-offset-1 col-lg-2 col-sm-12 col-xs-12 list-margin ">    
        			<p class="editdesc-text">Description</p>
        		</div>
        		<div class="col-lg-7 col-sm-12 col-xs-12 list-margin mobilelist-margin">
					<textarea data-value="description" class="desc-margin"></textarea>
				</div>
				<div class="row">
        			<div class="col-lg-offset-1 col-lg-2 col-sm-12 col-xs-12 list-margin">    
            			<p>Correct actions</p>
           			</div>
            		<div class="col-lg-7 col-sm-12 col-xs-12 list-content-margin">
						<template data-array="actions">
							<li class="dilemma-list editdil-position"><input type="text" data-value=""></li>|
						</template>
            		</div>
       			</div>
       			<div class="row">
           			<div class="col-lg-offset-1 col-lg-2 col-sm-12 col-xs-12 list-margin">
            		   <p>Features</p>
           			</div>
           			<div class="col-lg-7 col-sm-12 col-xs-12 list-content-margin">
						<template data-array="features">
						<li class="dilemma-list">
							<input type="text" data-value="" oninput="console.log('input')">
							<a class="remove" onclick="remove_feature(this)"><img src="images/close.png" class="close-btn" alt="close" data-toggle="tooltip" title="Remove"></a>
						</li><br>
						</template>
						<li class="dilemma-list">
							<input type="text" placeholder="Add a feature" onchange="add_feature(this)">
						</li>
           			</div>
       			</div>
       			<div class="row">
           			<div class="col-lg-offset-1 col-lg-2 col-sm-12 col-xs-12 list-margin">
            	   		<p>Key takeaway/Duties</p>
           			</div>
           			<div class="col-lg-7 col-sm-12 col-xs-12 list-content-margin">
            			<p>It can be inferred that there are (prima facie) duties to:</p>
						<template data-array="duties">
							<li class="dilemma-list editdil-position"><input type="text" data-value=""></li>
						</template>
           			</div>
       			</div>
				<div class="row">
        			<div class="col-lg-offset-1 col-lg-2 col-sm-12 col-xs-12 list-margin">
            			<p>Rules</p>
            		</div>
            		<div class="col-lg-7 col-sm-12 col-xs-12 rule-dilemma">
						<ul class="principles">
							<template data-array="principles">
								<li class="principle dilemma-list">
									<p>An action is ethically preferable to another if it</p>
									<ul class="clauses">
										<template data-array="clauses">
											<li class="clause dilemma-list"><input type="text" data-value=""></li>
										</template>
									</ul>
								</li>
							</template>
						</ul>
            		</div>
        		</div>
				<div class="row">
					<div class="col-lg-offset-1 col-lg-11 col-sm-12 col-xs-12">
						<button id="dilemma_save" class="btn btn-primary save" onclick="store_dilemma()">
							<span>Save</span>
						</button>
						<button id="dilemma_delete" class="btn btn-danger delete" onclick="delete_dilemma()">
							<span>Delete</span>
						</button>
					</div>
				</div>
			</div>
			<div class="tab-pane" id="editdilemmacases">
				<div class="row">
        			<div class="col-lg-offset-1 col-lg-2 col-md-12 col-sm-12 col-xs-12 list-margin">
            			<p>Cases</p>
            		</div>
            		<div class="col-lg-7 col-md-12 col-sm-12 col-xs-12 list-content-margin">
            		  	 <div class="row">
							<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            		        	<a href="#" class="li-content-link" onclick="add_case(this)">+ ADD CASE</a>
							</div>
							<template data-array="cases">
								<div class="col-lg-6 col-md-12 col-sm-12 col-xs-12" onclick="edit_case(this)">
									<input type="hidden" data-value="id">
            		            	<br>
            		                <p data-content="name"></p> <a href="#" class="li-content-link">READ MORE</a>
            		                <br>
									<p data-content="description"></p>
            		                Correct action:
									<p data-content="action"></p>
            		            </div>
							</template>
						</div>
					</div>
				</div>
			</div>
			<div class="tab-pane" id="editdilemmadiscussion">
				<div class="row">
                	<div class="col-lg-offset-3 col-lg-9 col-md-offset-3 col-md-9 col-sm-12 col-xs-12 list-margin">
                	    <a href="#" class="li-content-link">+ADD COMMENT</a>&nbsp; &nbsp; &nbsp;<a href="#" class="li-content-link">+ADD FILTERS</a>&nbsp;<span>(no filters)</span>
                	</div>    
            	</div>
            	<div class="row">
                	<div class="col-lg-offset-2 col-lg-1 col-md-offset-2 col-md-1 col-sm-2 col-xs-2 list-margin">    
                	    <img src="images/star.jpg"/>
                	</div>
                	<div class="col-lg-8 col-md-8 col-sm-10 col-xs-10 comment-margin">
                	        <p><b>Remco Bloemen</b> added case: <b>Name</b>
                	        </p>
                	        <span><a href="#" class="tab">Reply</a>&nbsp; &nbsp; <a href="#" class="tab">Comment</a>&nbsp; &nbsp;<img src="images/heart.jpg"/>
                	        </span>
                	</div>  
            	</div>
            	<div class="row">
                	<div class="col-lg-offset-2 col-lg-1 col-md-offset-2 col-md-1 col-sm-2 col-xs-2 list-margin">    
                    	<img src="images/yellowstar.jpg"/>
                	</div>
                	<div class="col-lg-8 col-md-8 col-sm-10 col-xs-10 comment-margin">
                        <p><b>Remco Bloemen</b> added dillema : <b>Autonomous car</b>
                        </p>
                        <span><a href="#" class="tab">Reply</a>&nbsp; &nbsp; <a href="#" class="tab">Comment</a>&nbsp; &nbsp;<img src="images/heart.jpg"/>
                        </span>
                	</div>  
            	</div>
            	<div class="row">
                	<div class="col-lg-offset-2 col-lg-1 col-md-offset-2 col-md-1 col-sm-2 col-xs-2 list-margin">    
                	    <img src="images/lightmessage.jpg"/>
                	</div>
                	<div class="col-lg-8 col-md-8 col-sm-10 col-xs-10 comment-margin">
                        <p><b>Remco Bloemen</b> added on case <b>Name 1</b> :Somehow comments at least two levels facebook like comment.
                        <br>Mentions @Nell Watson (one more color needed)
                        </p>
                        <span><a href="#" class="tab">Reply</a>&nbsp; &nbsp; &nbsp; &nbsp;<img src="images/heart.jpg"/>
                        </span>
                        <div class="div-margin">
                            <p><b>Nell Watson</b>Writes something</p>
                            <span><a href="#" class="tab">Reply</a>&nbsp; &nbsp; &nbsp; &nbsp;<img src="images/heart.jpg"/>
                            </span>
                        </div>
                	</div>  
            	</div>
				<div class="row">
                	<div class="col-lg-offset-2 col-lg-1  col-md-offset-2 col-md-1 col-sm-2 col-xs-2 list-margin">    
                	    <img src="images/yellowmessage.jpg"/>
                	</div>
                	<div class="col-lg-8 col-md-8 col-sm-10 col-xs-10 comment-margin">
                        <p><b>Remco Bloemen</b> on dillema <b>Autonomous Vehicles</b> :Somehow comments at least two levels facebook
                            like comment. Mentions @Nell Watson (one more color needed)
                        </p>
                        <span><a href="#" class="tab">Reply</a>&nbsp; &nbsp; &nbsp; &nbsp;<img src="images/heart.jpg"/>
                        </span>
                	</div>
            	</div>
            	<div class="row">
                	<div class="col-lg-offset-2 col-lg-1 col-md-offset-2 col-md-1 col-sm-2 col-xs-2 list-margin">
                	    <img src="images/message.jpg"/>
                	</div>
                	<div class="col-lg-8 col-md-8 col-sm-10 col-xs-10 comment-margin">
                        <p><b>Ola</b> on feature <b>Harm</b> :Lorem ipsum dolores etc.
                        </p>
                        <span><a href="#" class="tab">Reply</a>&nbsp; &nbsp; &nbsp; &nbsp;<img src="images/heart.jpg"/>
                        </span>
                	</div>
            	</div>
            	<div class="row">
                	<div class="col-lg-offset-2 col-lg-1  col-md-offset-2 col-md-1 col-sm-2 col-xs-2 list-margin">
                    	<img src="images/yellowmessage.jpg"/>
                	</div>
                	<div class="col-lg-8 col-md-8 col-sm-10 col-xs-10 comment-margin">
                        <p><b>Remco Bloemen</b> on dillema <b>Autonomous Vehicles</b> :
                        </p>
                        <div class="">
                            <p><i>Part of the dilemma, lorem ipsum</i></p>
                        </div>
                        <p>Somehow comments at least two levels facebook like comment. Mentions
                            @Nell Watson (one more color needed)
                        </p>
                        <span><a href="#" class="tab">Reply</a>&nbsp; &nbsp; &nbsp; &nbsp;<img src="images/blackheart.jpg"/>
                        </span>
                	</div>
            	</div>
            	<div class="row">
                	<div class="col-lg-offset-2 col-lg-1  col-md-offset-2 col-md-1 col-sm-2 col-xs-2 list-margin">
                	    <img src="images/yellowmessage.jpg"/>
                	</div>
                	<div class="col-lg-8 col-md-8 col-sm-10 col-xs-10 comment-margin">
                	        <p><b>Remco Bloemen</b> on dillema <b>Autonomous Vehicles</b> :
                	        </p>
                	        <p>The driver of the car is either speeding, comment comment comment comment commet certain
                	            circumstances, normal rules of the road can be fairly circumvented. Comment comment comment
                	            Alternative version of a comment with a quote.
                	        </p>
                	        <span><a href="#" class="tab">Reply</a>&nbsp; &nbsp; &nbsp; &nbsp;<img src="images/blackheart.jpg"/>
                	        </span>
                	</div>
				</div>
			</div>
		</div>
	</div>
</main>

<main id="edit_case" class="hidden">
	<input type="hidden" data-value="id">
	<input type="hidden" data-value="position">
	<input type="hidden" data-value="dilemma_id">

    <div class="container">
		<div class="row list-header-margin">
   			<div class="col-lg-offset-2 col-lg-10 col-md-offset-2 col-md-10 col-sm-12 col-xs-12">
        		<img src="images/vehicles.jpg" class="resize-img hidden-xs"/>    
        	    	<p class="title-margin">Autonomous Vehicles</p>
        	        <small>Added by Remco Bloemen</small>    
        	</div>  
        </div>
		<div class="row text-bar">
		   <div class="col-lg-offset-2 col-lg-10 col-md-offset-2 col-md-10 col-sm-12 col-xs-12">
			  <ul class="li-position">
				  <li class="li-style"><a href="#" class="field-li-link" onclick="add_case(this)">+ADD CASE</a></li>
				  <li class="li-style">
					  <a href="#" class="field-li-link"><b>EDITED</b></a>
				  </li>
				</ul>
			</div>
		</div>			
		<div class="col-lg-offset-2 col-lg-8 col-md-offset-2 col-md-8 col-sm-12 col-xs-12">
			<div class="form-group">
				<label for="title" class="title-margin">Title</label>
				<input type="title" class="form-control" id="title" data-value="name" placeholder="Input value">
			</div>
			<div class="form-group">
				<label for="description">Description</label>
				<textarea name="description" id="description" data-value="description">Text area content
				</textarea>
			</div>
			<div class="form-group">
				<label for="actions">Correct Action</label>
					<div class="row">
						<div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
						<input type="radio" name="correct_action[]">Action A<br>
						<input type="radio" name="correct_action[]">Action B<br>
						<br>
						<a href="#" class="form-link">+ADD ACTION</a>
						</div>						
					</div>
			</div>
			<div class="form-group">						
				<label for="actions">Features</label>
				<div class="row">
					<div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
						<template data-array="feature_labels">
							<div class="vertical feature_slider" data-action="0">
								<label><input type="checkbox" data-value=""><span data-content=""></span></label>									
								<input type="range" min="-3" max="3" step="1" /><br>								
							</div>							
						</template>
						<a href="#" class="form-link">+ADD FEATURE</a>
					</div>
					<div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
						<template data-array="feature_labels">
							<div class="vertical feature_slider" data-action="0">
								<label><input type="checkbox" data-value=""><span data-content=""></span></label>									
								<input type="range" min="-3" max="3" step="1" /><br>
							</div>
						</template>
					</div>				
				</div>
			</div>						
		</div>				
		<div class="row">
			<div class="col-lg-offset-2 col-lg-10 col-md-offset-2 col-md-10 col-sm-12 col-xs-12">
				<div class="form-group">
				<button id="case_save" class="btn btn-primary save" onclick="store_case()">
					<span>Save</span>
				</button>
				<button id="case_delete" class="btn btn-danger delete" onclick="delete_case()">
					<span>Delete</span>
				</button>
				</div>
			</div>
		</div>
	</div>
</main>

<main id="add_comment" class="hidden">
	<div class="container">
    	<div class="row list-header-margin">
        	<div class="col-lg-offset-3 col-lg-9 col-md-offset-2 col-md-10 col-sm-12 col-xs-12">
            	<img src="images/vehicles.jpg" class="resize-img hidden-xs"/>    
                <p class="title-margin">Autonomous Vehicles</p>
                <small>Added by Remco Bloemen</small>    
            </div>  
        </div>
        <div class="row text-bar">
           <div class="col-lg-offset-3 col-lg-9 col-md-offset-3 col-md-9 col-sm-12 col-xs-12">
               <ul class="li-position">
                   <li class="li-style"><p class="field-li-link">New Comment on</p></li>
                   <li class="li-style">
                       <select name="field">
                           <option value="DILEMMA" selected><b>DILEMMA</b></option>
                           <option value="CASE"><b>CASE</b></option>
                           <option value="FEATURE"><b>FEATURE</b></option>
                       </select>
                   </li>
              </ul>
           </div>
        </div>
        <div class="row">
            <div class="col-lg-offset-3 col-lg-9 col-md-offset-3 col-md-9 col-sm-12 col-xs-12">
				<!-- TODO only show if this is a comment on a case -->
				<select name="cases" class="select-margin">
                   <option value=""><b>KILLING AN OLD COUPLE OVER A CHILD</b></option>
                   <option value=""></option>
                </select>
				<!-- END TODO -->
				<!-- TODO only show if this is a comment on a feature -->
				<select name="cases" class="select-margin">
                    <option value=""><b>HARM</b></option>
                    <option value=""></option>
                </select>
				<!-- END TODO -->
               <p>Comment</p>
               <textarea name="message">The driver of the car is either speeding, not staying in his/her lane,or about to hit an object. A range of circumstances might influence the driver's behaviour. In certain circumstances, normal rules of theroad can be fairly circumvented. Should an autonomous system take control of the car, and if so, at what point?
               </textarea>
               <button type="button" class="save-btn">SAVE</button>
            </div>
        </div>
	</div>
</main>

<main id="not_found" class="hidden">
	<p class="one-column">The request page is not found!</p>
	<p class="one-column">(it might be under construction, check back later!)</p>
</main>

<footer class="page-footer">
	<div class="col-lg-12">
		<span>&nbsp;&nbsp;Contact:team@openeth.com</span>&nbsp;&nbsp;&nbsp;&nbsp;
		<span>&copy; OpenEth 2016</span>
	</div>
   
</footer>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/notifications.js"></script>
<script type="text/javascript" src="//cdn.auth0.com/js/lock-9.0.js"></script>
<script type="text/javascript" src="/authentication.js"></script>
<script type="text/javascript" src="/script.js"></script>
<script type="text/javascript" src="/openeth.js"></script>
<script type="text/javascript">


function open_dilemma(node) {
	var id = node.getElementsByTagName('input')[0].value;
	go_to("/dilemmas/" + id);
}

function edit_dilemma(event, node) {
	event.stopPropagation();
	var id = node.getElementsByTagName('input')[0].value;
	go_to("/dilemmas/" + id + "?edit");
}

function add_feature(node) {
	var dilemma = extract('edit_dilemma');
	dilemma.features.push(node.value);
	join('edit_dilemma', dilemma);
	console.log(dilemma);
	node.value = "";
}

function remove_feature(node) {
	node.parentNode.remove();
	// TODO: Update cases
}

function set_edit_current_dilemma_visibility() {
	var data = extract('dilemma');
	var button = document.querySelectorAll('#head_dilemma button')[0];
	if(data.author == user_id) {
		button.classList.remove('hidden');
	} else {
		button.classList.add('hidden');
	}
}

function edit_current_dilemma() {
	var data = extract('dilemma');
	go_to('/dilemmas/' + data.id + '?edit');
}

function set_edit_current_case_visibility() {
	var data = extract('case');
	var button = document.querySelectorAll('#head_case button')[0];
	if(data.author == user_id) {
		button.classList.remove('hidden');
	} else {
		button.classList.add('hidden');
	}
}

function edit_current_case() {
	var data = extract('case');
	go_to('/cases/' + data.id + '?edit');
}

function store_dilemma(callback) {
	var dilemma = extract('edit_dilemma');
	var body = {
		name: dilemma.name,
		description: dilemma.description,
		actions: dilemma.actions,
		features: dilemma.features
	};
	if(typeof(callback) != 'function') {
		callback = go_to.bind(null, ['/']);
	}
	
	// Style the button
	var button = document.getElementById('dilemma_save');
	var span = button.getElementsByTagName('span')[0];
	button.classList.remove('done');
	button.classList.remove('error');
	button.classList.add('active');
	span.classList.add('spinner-before');
	var done = function() {
		console.log("ASD");
		button.classList.remove('active');
		span.classList.remove('spinner-before');
		button.classList.add('done');
		notify('Dilemma saved', 5, "info");
		callback();
	}
	var failed = function(error) {
		console.log("ASD");
		button.classList.remove('active');
		span.classList.remove('spinner-before');
		button.classList.add('error');
		notify("Error: " + error, 30, "error");
	};
	
	// Insert or Update
	if(dilemma.id) {
		// Update
		api.patch('dilemmas')
		.eq('id', dilemma.id)
		.body(body)
		.then(done)
		.catch(failed);

		// TODO: Cases
		
	} else {
		// Insert
		api.post('dilemmas')
		.representation()
		.select('id, author')
		.body(body)
		.then(function(result) {
			join('edit_dilemma', {id: result.id, author: result.author});
			
			// Update URL
			window.history.replaceState(null, "", "/dilemmas/" + result.id + "?edit");
			done();
		})
		.catch(failed);
	}
}

function delete_dilemma() {
	var dilemma = extract('edit_dilemma');
	
	// Style the button
	var button = document.getElementById('dilemma_delete');
	var span = button.getElementsByTagName('span')[0];
	button.classList.remove('done');
	button.classList.remove('error');
	button.classList.add('active');
	span.classList.add('spinner-before');
	var done = function() {
		button.classList.remove('active');
		span.classList.remove('spinner-before');
		button.classList.add('done');
		notify('Dilemma deleted', 5, "info");
		go_to('/');
	}
	var failed = function(error) {
		button.classList.remove('active');
		span.classList.remove('spinner-before');
		button.classList.add('error');
		notify("Error: " + error, 30, "error");
	};
	
	if(dilemma.id) {
		api.delete('dilemmas')
		.eq('id', dilemma.id)
		.then(done)
		.catch(failed);
	} else {
		go_to('/');
	}
}

function add_case() {
	// Store the change to the dilemma first, then move to the new case
	// (This also ensures that the dilemma has an id assigned)
	store_dilemma(function() {
		var dilemma = extract('edit_dilemma');
		go_to("/cases/new?edit&dilemma=" + dilemma.id + "&position=" + dilemma.cases.length);
	});
}

function edit_case(node) {
	var id = node.getElementsByTagName('input')[0].value;
	
	// Store the change to the dilemma first, then move to the new case
	// (This also ensures that the dilemma has an id assigned)
	store_dilemma(function(){
		go_to("/cases/" + id + "?edit");
	});
}

function open_case(node) {
	var id = node.getElementsByTagName('input')[0].value;
	go_to("/cases/" + id);
}

function set_correct_action(index) {
	if(index == 0 || index == 1) {
		document.querySelectorAll(
			'#edit_case input[name="correct_action"]'
		)[index].checked = true;
	}
}

function get_correct_action() {
	var selected = document.querySelectorAll(
		'#edit_case input[name="correct_action"]:checked');
	if(selected.length == 0)
		return null;
	else
		return selected[0].parentNode.dataset.actionIndex
}

function set_feature_sliders(features) {
	for_each(document.querySelectorAll(".feature_slider"), function(el) {
		var action = el.dataset.action;
		var index = el.dataset.arrayIndex;
		var check = el.querySelectorAll("input[type=checkbox]")[0];
		var slider = el.querySelectorAll("input[type=range]")[0];
		
		// Install behaviour
		check.addEventListener('change', (function(){
			var c = check;
			var s = slider;
			return function(event) {
				s.disabled = c.checked ? false : true;
			};
		})());
		
		// Set state
		var value = features[action][index];
		if(value === null) {
			check.checked = false;
			slider.disabled = true;
			slider.value = 0; // TODO: Opposite of other action
		} else {
			check.checked = true;
			slider.disabled = false;
			slider.value = value;
		}
	});
}

function get_feature_sliders() {
	var values = [[],[]];
	for_each(document.querySelectorAll(".feature_slider"), function(el) {
		var action = el.dataset.action;
		var index = el.dataset.arrayIndex;
		var check = el.querySelectorAll("input[type=checkbox]")[0];
		var slider = el.querySelectorAll("input[type=range]")[0];
		values[action].push(check.checked ? slider.value : null);
	});
	return values;
}

function store_case() {
	var data = extract('edit_case');
	var body = {
		dilemma: data.dilemma_id,
		position: data.position,
		name: data.name,
		description: data.description,
		action: get_correct_action(),
		features: get_feature_sliders()
	};
	
	// Style the button
	var button = document.getElementById('case_save');
	var span = button.getElementsByTagName('span')[0];
	button.classList.remove('done');
	button.classList.remove('error');
	button.classList.add('active');
	span.classList.add('spinner-before');
	var done = function() {
		button.classList.remove('active');
		span.classList.remove('spinner-before');
		button.classList.add('done');
		notify('Case saved', 5, "info");
		go_to('/dilemmas/' + data.dilemma_id + '?edit');
	}
	var failed = function(error) {
		button.classList.remove('active');
		span.classList.remove('spinner-before');
		button.classList.add('error');
		notify("Error: " + error, 30, "error");
		go_to('/dilemmas/' + data.dilemma_id + '?edit');
	};
	
	if(data.id) {
		// Update
		delete body.dilemma;
		api.patch('cases')
		.eq('id', data.id)
		.body(body)
		.then(done)
		.catch(failed);
		
	} else {
		// Insert
		api.post('cases')
		.representation()
		.select('id')
		.body(body)
		.then(function(result) {
			join('edit_case', {id: result.id});
			
			// Update URL
			window.history.replaceState(null, "", "/cases/" + result.id + "?edit");
			
			done();
		})
		.catch(failed);
	}
}

function delete_case() {
	var data = extract('edit_case');
	
	// Style the button
	var button = document.getElementById('case_delete');
	var span = button.getElementsByTagName('span')[0];
	button.classList.remove('done');
	button.classList.remove('error');
	button.classList.add('active');
	span.classList.add('spinner-before');
	var done = function() {
		button.classList.remove('active');
		span.classList.remove('spinner-before');
		button.classList.add('done');
		notify('Case deleted', 5, "info");
		go_to('/dilemmas/' + data.dilemma_id + '?edit');
	}
	var failed = function(error) {
		button.classList.remove('active');
		span.classList.remove('spinner-before');
		button.classList.add('error');
		notify("Error: " + error, 30, "error");
		go_to('/dilemmas/' + data.dilemma_id + '?edit');
	};
	
	if(data.id) {
		api.delete('cases')
		.eq('id', data.id)
		.then(done)
		.catch(failed);
	} else {
		go_to('/dilemmas/' + data.dilemma_id + '?edit');
	}
}

function show_edit_buttons() {
	
	// Check if we are moderator
	var moderator = user_profile != null && user_profile.role == 'moderator';
	
	// Dilemmas overview
	for_each(document.querySelectorAll("#start section.dilemma"), function(el) {
		var author = el.getElementsByTagName('input')[1].value;
		if(author == user_id) {
			el.classList.add('editable');
		} else {
			el.classList.remove('editable');
		}
	});
		
	// Dilemma
	var data = extract(document.getElementById('dilemma'));
	var button = document.querySelectorAll('#head_dilemma button.edit')[0];
	if(moderator || data.author == user_id) {
		button.classList.remove('hidden');
	} else {
		button.classList.add('hidden');
	}
	
	// Case
	var data = extract(document.getElementById('case'));
	var button = document.querySelectorAll('#head_case button.edit')[0];
	if(moderator || data.author == user_id) {
		button.classList.remove('hidden');
	} else {
		button.classList.add('hidden');
	}
}

function dilemmas_add_cases_count(state) {
	if('forEach' in state.dilemmas) {
		state.dilemmas.forEach(function(dilemma) {
			dilemma.num_cases = dilemma.cases.length;
		});
	}
}

function dilemma_sort_cases(state) {
	state.cases.sort(function(a, b) {
		if(a.position < b.position) {
			return -1;
		}
		if(a.position > b.position) {
			return 1;
		}
		return 0;
	});
}

function load_state(url, callback) {
	notify("Loading state for " + url + "...", 5, "debug");
	if(url.path.length == 0) {
		api.get('dilemmas')
		.select('*,cases{id}')
		.order('id', true)
		.then(callback);
	} else if(url.path.length == 2 && url.path[0] == 'dilemmas') {
		if(url.path[1] == 'new') {
			callback({
				id: null,
				name: "New Dilemma",
				description: "Please edit this dilemma.",
				actions: ["Action A", "Action B"],
				features: ["Feature 1"],
				cases: []
			});
		} else {
			api.get('dilemmas')
			.select('*,cases{*}')
			.eq('id', url.path[1])
			.single()
			.then(callback);
		}
	} else if(url.path.length == 2 && url.path[0] == 'cases') {
		if(url.path[1] == 'new') {
			api.get('dilemmas')
			.select('*')
			.eq('id', url.query.dilemma)
			.single()
			.then(function(dilemma) {
				callback({
					id: null,
					position: url.query.position,
					dilemma: dilemma,
					name: "New Case",
					description: "",
					action: undefined,
					features: [
							[null].repeat(dilemma.features.length)
						].repeat(dilemma.actions.length)
				});
			});
		} else {
			api.get('cases')
			.select('*,dilemma{*}')
			.eq('id', url.path[1])
			.single()
			.then(callback);
		}
	} else {
		callback({});
	}
}

function load_page(url, state) {
	notify("Constructing page for " + url + "...", 5, "debug");
	state = deep_copy_object(state);
	for_each(document.querySelectorAll('main, header > #head > div'), function(el) {
		el.classList.add('hidden');
	});
	
	// Reset button states
	for_each(document.querySelectorAll('body > header button'), function(button) {
		button.classList.remove('done');
		button.classList.remove('error');
		button.classList.remove('active');
	});
	for_each(document.querySelectorAll('body > header button span.spinner-before'), function(el) {
		el.classList.remove('spinner-before');
	});
	
	//try {
		if(url.path.length == 0) {
			state = { dilemmas: state };
			dilemmas_add_cases_count(state);
			//join('head_start', state).classList.remove('hidden');
			join('start', state).classList.remove('hidden');
		} else if(url.path.length == 2 && url.path[0] == 'dilemmas') {
			dilemma_sort_cases(state);
			solve_dilemma(state);
			dilemma_map_actions(state);
			if('edit' in url.query) {
				//join('head_edit_dilemma', state).classList.remove('hidden');
				join('edit_dilemma', state).classList.remove('hidden');
				rescale_textareas();
			} else {
				join('head_dilemma', state).classList.remove('hidden');
				join('dilemma', state).classList.remove('hidden');
			}
		} else if(url.path.length == 2 && url.path[0] == 'cases') {
			state.dilemma_id = state.dilemma.id;
			state.author = state.dilemma.author;
			state.actions = state.dilemma.actions;
			state.action_0 = state.dilemma.actions[0];
			state.action_1 = state.dilemma.actions[1];
			state.feature_labels= state.dilemma.features;
			state.action_label = state.actions[state.action];
			if('edit' in url.query) {
				//join('head_edit_case', state).classList.remove('hidden');
				join('edit_case', state).classList.remove('hidden');
				rescale_textareas();
				set_correct_action(state.action);
				set_feature_sliders(state.features);
			} else {
				case_map_features(state);
				join('head_case', state).classList.remove('hidden');
				join('case', state).classList.remove('hidden');
			}
		} else {
			document.getElementById('not_found').classList.remove('hidden');
		}
		show_edit_buttons();
	//} catch(error) {
	//	// TODO: Show error page.
	//	console.error(error);
	//}
}

function go_to(url) {
	if(url.indexOf("#") != -1)
	{
		return;
	}
	url = parse_url(url);
	notify("Going to " + url + "...", 5, "debug");
	load_state(url, function(state) {
		load_page(url, state);
		window.history.pushState(state, "", url);
	});
}

// Intercept hyperlinks
document.addEventListener('click', function(e) {
	
	// Filter anything but normal site-local link click
	if(e.type != 'click')
		return;
	if(e.button != 0)
		return;
	if(e.shiftKey || e.altKey || e.ctrlKey || e.metaKey)
		return;
	if(e.target.tagName != 'A')
		return;
	if(e.target.hostname != window.location.hostname)
		return;
	
	// Use go_to instead of a loading a page
	go_to(e.target.href);
	
	// Tell the browser to further ignore the click
	e.preventDefault();
	
});

window.addEventListener('DOMContentLoaded', function() {
	var url = parse_url(window.document.location);
	if(window.history.state === null || true) {
		notify("Starting on " + url + "...", 5, "debug");
		load_state(url, function(state){
			load_page(url, state);
			window.history.replaceState(state, "", window.document.location.href);
		});
	} else {
		notify("Using cached state...", 5, "debug");
		load_page(url, window.history.state);
	}
});

window.addEventListener('popstate', function(event) {
	var url = parse_url(window.document.location);
	notify("Going back to " + url + "...", 5, "debug");
	
	load_page(url, event.state);
});

document.addEventListener('log_in_try', function(event) {
	notify("Trying to log in...", 5, "debug");
	document.getElementById('throbber_login').classList.remove('hidden');
	document.getElementById('button_login').classList.add('hidden');
	document.getElementById('button_logout').classList.add('hidden');
});
document.addEventListener('log_in', function(event) {
	notify("Logged in as " + user_profile.nickname, 5);
	document.getElementById('throbber_login').classList.add('hidden');
	document.getElementById('button_login').classList.add('hidden');
	document.getElementById('button_logout').classList.remove('hidden');
	document.getElementById('add_dilemma').classList.remove('hidden');
	show_edit_buttons();
});

// In case the user is already logged in on page load.
if(user_profile) {
	notify("Logged in as " + user_profile.nickname, 5, 'debug');
	document.getElementById('throbber_login').classList.add('hidden');
	document.getElementById('button_login').classList.add('hidden');
	document.getElementById('button_logout').classList.remove('hidden');
	document.getElementById('add_dilemma').classList.remove('hidden');
	show_edit_buttons();
}

document.addEventListener('log_out', function(event) {
	notify("Logged out", 5);
	document.getElementById('throbber_login').classList.add('hidden');
	document.getElementById('button_login').classList.remove('hidden');
	document.getElementById('button_logout').classList.add('hidden');
	show_edit_buttons();
});


</script>
</body>
</html>
